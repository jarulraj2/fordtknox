"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1517],{38078:function(e,t,r){r.d(t,{H:function(){return i},a:function(){return n}});var o=r(57437),a=r(2265);r(93375);let l=(0,a.createContext)({}),i=e=>{let{children:t}=e,[r,i]=(0,a.useState)(),[n,s]=(0,a.useState)(),[u,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=localStorage.getItem("user");JSON.parse(e||"{}")&&(i(JSON.parse(e)),s("loggedIn"))},[]);let d=(0,a.useCallback)(async e=>{i(e),s("loggedIn"),localStorage.setItem("user",JSON.stringify(e)),localStorage.setItem("authStatus","loggedIn")},[]),p=(0,a.useCallback)(async()=>{i(null),s("loggedOut"),localStorage.setItem("user",null),localStorage.setItem("authStatus","loggedOut"),await fetch("/api/auth/logout")},[]);(0,a.useEffect)(()=>{(async()=>{i(JSON.parse(localStorage.getItem("user"))||null)})()},[]);let g=(0,a.useCallback)(async e=>{let t=JSON.parse(localStorage.getItem("user"));try{let r=await fetch("/api/customers/".concat(t.id),{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok){let{doc:e,errors:t}=await r.json();if(t)throw Error(t[0].message);return i(e),localStorage.setItem("user",JSON.stringify(e)),r}throw Error("Error updating! Please try again later.")}catch(e){throw Error("An error occurred while attempting to update.")}},[]),y=(0,a.useCallback)(async e=>{let t=JSON.parse(localStorage.getItem("user"));try{c(!0);let r=await fetch("".concat("https://cmsprod.garmin-india.com","/api/customers/").concat(t.id,"/wishlist/add/").concat(e),{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(r.ok){let e=await r.json();if(e.errors)throw Error(e.errors[0].message);i(e),localStorage.setItem("user",JSON.stringify(e))}else throw Error("Error updating! Please try again later.");return c(!1),r}catch(e){throw c(!1),Error("An error occurred while attempting to update.")}},[]),m=(0,a.useCallback)(async e=>{let t=JSON.parse(localStorage.getItem("user"));try{c(!0);let r=await fetch("".concat("https://cmsprod.garmin-india.com","/api/customers/").concat(t.id,"/wishlist/remove/").concat(e),{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(r.ok){let e=await r.json();if(e.errors)throw Error(e.errors[0].message);i(e),localStorage.setItem("user",JSON.stringify(e))}else throw Error("Error updating! Please try again later.");return c(!1),r}catch(e){throw c(!1),Error("An error occurred while attempting to update.")}},[]),f=(0,a.useCallback)(async e=>{try{let r=await fetch("".concat("https://cmsprod.garmin-india.com","/api/users/forgot-password"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email})});if(r.ok){var t;let{data:e,errors:o}=await r.json();if(o)throw Error(o[0].message);i(null==e?void 0:null===(t=e.loginUser)||void 0===t?void 0:t.user)}else throw Error("Invalid login")}catch(e){throw Error("An error occurred while attempting to login.")}},[]),h=(0,a.useCallback)(async e=>{try{let o=await fetch("".concat("https://cmsprod.garmin-india.com","/api/users/reset-password"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e.password,passwordConfirm:e.passwordConfirm,token:e.token})});if(o.ok){var t,r;let{data:e,errors:a}=await o.json();if(a)throw Error(a[0].message);i(null==e?void 0:null===(t=e.loginUser)||void 0===t?void 0:t.user),s((null==e?void 0:null===(r=e.loginUser)||void 0===r?void 0:r.user)?"loggedIn":void 0)}else throw Error("Invalid login")}catch(e){throw Error("An error occurred while attempting to login.")}},[]);return(0,o.jsx)(l.Provider,{value:{user:r,setUser:i,login:d,logout:p,resetPassword:h,forgotPassword:f,updateUser:g,removeItemFromWishlist:m,addItemToWishlist:y,isUpdating:u,status:n},children:t})},n=()=>(0,a.useContext)(l)},21517:function(e,t,r){r.d(t,{Z:function(){return p},j:function(){return u}});var o=r(57437),a=r(2265),l=r(38078);let i=(e,t)=>{var r,o,a;switch(t.type){case"SET_CART":return t.payload;case"MERGE_CART":{let{payload:r}=t,o=[...(null==e?void 0:e.items)||[],...(null==r?void 0:r.items)||[]].reduce((e,t)=>{var r;let o="string"==typeof t.product?t.product:null==t?void 0:null===(r=t.product)||void 0===r?void 0:r.id,a=e.findIndex(e=>{let{product:t}=e;return"string"==typeof t?t===o:(null==t?void 0:t.id)===o});return a>-1?e[a]={...e[a]}:e.push(t),e},[]);return{...e,items:o}}case"ADD_ITEM":{let{payload:a}=t,l="string"==typeof a.product?a.product:null==a?void 0:null===(r=a.product)||void 0===r?void 0:r.id,i=null==e?void 0:null===(o=e.items)||void 0===o?void 0:o.findIndex(e=>{let{product:t}=e;return"string"==typeof t?t===l:(null==t?void 0:t.id)===l}),n=[...(null==e?void 0:e.items)||[]];return -1===i&&n.push(a),"number"==typeof i&&i>-1&&(n[i]={...n[i],quantity:(a.quantity||0)>0?a.quantity:void 0}),{...e,items:n}}case"DELETE_ITEM":{let{payload:r}=t,o={...e},l=null==e?void 0:null===(a=e.items)||void 0===a?void 0:a.findIndex(e=>{let{product:t}=e;return"string"==typeof t?t===r.id:(null==t?void 0:t.id)===r.id});return"number"==typeof l&&o.items&&l>-1&&o.items.splice(l,1),o}case"CLEAR_CART":return{...e,items:[]};case"ADD_COUPON":{let{payload:r}=t;return{...e,coupon:r}}case"REMOVE_COUPON":{let{payload:r}=t;return{...e,coupon:""}}default:return e}};var n=r(88726);let s=(0,a.createContext)(),u=()=>(0,a.useContext)(s),c=e=>Array.isArray(e)&&e.length>0,d=e=>({...e,items:e.items.map(e=>{var t,r;return(null==e?void 0:e.product)&&"object"==typeof(null==e?void 0:e.product)?{...e,product:null==e?void 0:null===(t=e.product)||void 0===t?void 0:t.id,quantity:"number"==typeof(null==e?void 0:e.quantity)?null==e?void 0:e.quantity:0,categories:null==e?void 0:null===(r=e.product)||void 0===r?void 0:r.categories.map(e=>e.id)}:null}).filter(Boolean)}),p=e=>{let{children:t}=e,{user:r,authStatus:u}=(0,l.a)(),[p,g]=(0,a.useReducer)(i,{}),[y,m]=(0,a.useState)(!1),[f,h]=(0,a.useState)(null),[v,S]=(0,a.useState)(!1),E=(0,a.useCallback)(e=>{g({type:"ADD_ITEM",payload:e})},[]),w=(0,a.useCallback)(e=>{g({type:"DELETE_ITEM",payload:e})},[]),C=(0,a.useCallback)(()=>{g({type:"CLEAR_CART"})},[]),O=(0,a.useCallback)(e=>{g({type:"ADD_COUPON",payload:e})},[]),I=(0,a.useCallback)(()=>{g({type:"REMOVE_COUPON"})},[]),T=(0,a.useCallback)(e=>{let t=!1,{items:r}=p||{};return Array.isArray(r)&&r.length>0&&(t=!!r.find(t=>{let{product:r}=t;return"string"==typeof r?r===e.id:(null==r?void 0:r.id)===e.id})),t},[p]);(0,a.useEffect)(()=>{m(!0);let e=localStorage.getItem("cart");e?g({type:"SET_CART",payload:JSON.parse(e||{items:[]})}):g({type:"SET_CART",payload:{items:[]}}),m(!1),S(!0)},[]),(0,a.useEffect)(()=>{v&&(m(!0),localStorage.setItem("cart",JSON.stringify(p)),b())},[p]);let b=async()=>{m(!0),localStorage.getItem("cartDetails");let e=d(p),t=await fetch("".concat("https://www.garmin-india.com/","/api/order/calculate"),{credentials:"include",method:"POST",body:JSON.stringify({cart:e,user:r?r.id:""}),headers:{"Content-Type":"application/json"}});if(t.ok){let e=await t.json();e.coupon&&e.coupon.Error&&(n.ZP.error(e.coupon.Error),I()),localStorage.setItem("cartDetails",JSON.stringify(e)),h(e),m(!1)}};return(0,o.jsx)(s.Provider,{value:{cart:p,addItemToCart:E,deleteItemFromCart:w,cartIsEmpty:!c(null==p?void 0:p.items),clearCart:C,isProductInCart:T,isCartUpdating:y,addCouponToCart:O,removeCouponFromCart:I,cartDetails:f},children:t})}}}]);